<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GeoGuessr Debug Mode</title>
    <link href='https://unpkg.com/mapillary-js@4.1.0/dist/mapillary.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; background: #111; }
        #mly { flex: 1; width: 100%; min-height: 400px; background: #222; }
        #map { height: 300px; width: 100%; border-top: 4px solid #444; }
        .ui { position: absolute; top: 10px; left: 10px; z-index: 1000; }
        button { padding: 15px; cursor: pointer; background: #2ecc71; color: white; border: none; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="ui">
        <button onclick="checkGuess()">SUBMIT GUESS</button>
        <div id="status" style="color: white; margin-top: 10px; background: rgba(0,0,0,0.5); padding: 5px;">Status: Initializing...</div>
    </div>

    <div id="mly"></div>
    <div id="map"></div>

    <script src='https://unpkg.com/mapillary-js@4.1.0/dist/mapillary.js'></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        const MLY_TOKEN = 'MLY|26310050215287964|040380c26b7962fb3a60d6e62ad5d390';
        
        // Fixed location for testing (Eiffel Tower area)
        const targetLoc = { lat: 48.8584, lng: 2.2945 };
        const testImageId = '498763468512731'; 

        let map, mly, guessMarker;

        window.onload = function() {
            document.getElementById('status').innerText = "Status: Loading Map...";
            
            // 1. Setup Map
            map = L.map('map').setView([20, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

            map.on('click', (e) => {
                if (guessMarker) guessMarker.setLatLng(e.latlng);
                else guessMarker = L.marker(e.latlng).addTo(map);
            });

            // 2. Setup Mapillary
            try {
                mly = new mapillary.Viewer({
                    accessToken: MLY_TOKEN,
                    container: 'mly',
                    imageId: testImageId, // Start with a known working image
                    component: { cover: false }
                });
                
                mly.on('load', () => {
                    document.getElementById('status').innerText = "Status: Ready!";
                });
            } catch (err) {
                document.getElementById('status').innerText = "Status: Mapillary Failed to Load";
                console.error(err);
            }
        };

        function checkGuess() {
            if (!guessMarker) return alert("Click the map first!");
            const dist = map.distance(guessMarker.getLatLng(), [targetLoc.lat, targetLoc.lng]) / 1000;
            alert(`You were ${dist.toFixed(2)} km away from Paris!`);
        }
    </script>
</body>
</html>
